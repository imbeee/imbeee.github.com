<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="A blog containing some interesting things."><meta name="referrer" content="no-referrer"><title>ISG2015-RPG-400-Writeup | Beeeの零碎事</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ISG2015-RPG-400-Writeup</h1><a id="logo" href="/.">Beeeの零碎事</a><p class="description">Just so so~</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ISG2015-RPG-400-Writeup</h1><div class="post-meta">Jan 11, 2016</div><div class="post-content"><p>该题是由rpgmakerxp做的一个小迷宫。解压后一看，根目录下有个<code>config.txt</code>，里面为<code>202.120.7.132:9999</code>，初步判断游戏跟服务器有交互。运行游戏，方向键移动角色，wireshark确实能抓取到与服务器交互的数据。<br>用rpgmakerxp编辑该游戏的方法是：用rpgmakerxp新建一个游戏，保存，把游戏目录下的<code>Game.rxproj</code>复制到RPG目录里，再用rpgmakerxp打开该文件即可。<br>打开后，可以看到迷宫尺寸为499*499。同时在rpgmakerxp中，下标起始为0，用二元组表示为（列，行）。角色起始坐标在（1，1），宝箱在（497，497）。题目描述为打开宝箱即得flag。<br>从rpgmakerxp的工具菜单里打开脚本编辑器，拖到最下面看<code>Main</code>脚本，其中有这样的一段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host, port = File.new(&quot;config.txt&quot;, &quot;r&quot;).readline().strip().split(&quot;:&quot;)</span><br><span class="line">$CONN = TCPClient.new(host, port.to_i)</span><br><span class="line">$CONN.connect()</span><br></pre></td></tr></table></figure></p>
<p>再看<code>Gmae_Player</code>脚本中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def move_up(turn_enabled = true)</span><br><span class="line">  super</span><br><span class="line">  $CONN.send(&quot;w\n&quot;)</span><br><span class="line">end</span><br><span class="line">def move_down(turn_enabled = true)</span><br><span class="line">  super</span><br><span class="line">  $CONN.send(&quot;s\n&quot;)</span><br><span class="line">end</span><br><span class="line">def move_left(turn_enabled = true)</span><br><span class="line">  super</span><br><span class="line">  $CONN.send(&quot;a\n&quot;)</span><br><span class="line">end</span><br><span class="line">def move_right(turn_enabled = true)</span><br><span class="line">  super</span><br><span class="line">  $CONN.send(&quot;d\n&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<p>最后在模式菜单里切换到事件，双击位于（497，497）的宝箱，可以看到如下脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$CONN.send(&quot;flag\n&quot;)</span><br><span class="line">print $CONN.recvuntil(&quot;\n&quot;)</span><br></pre></td></tr></table></figure></p>
<p>根据上述脚本可以基本确定程序流程：</p>
<ul>
<li>游戏运行时从当前目录<code>config.txt</code>里读入服务器ip和端口，建立连接</li>
<li>玩家移动游戏角色时触发key_down事件，上下左右移动时分别向服务器发送wasd和换行符</li>
<li>打开宝箱时触发事件，向服务器发送’flag\n’并将服务器返回的数据打印出来</li>
</ul>
<p>先尝试将宝箱移动到坐标（2，1），保存，运行游戏后宝箱即在玩家原始位置右边。打开宝箱，提示no cheat，此法不通。<br>再尝试将玩家移动到（496，497），保存，运行游戏后玩家即在宝箱原始位置上面。打开宝箱，同样提示no cheat，此法同样行不通。<br>至此可初步判断，服务器上会对传来的方向序列进行处理，达到正确位置后打开宝箱才能获取flag。这样，我们就需要真正走完迷宫，到达（496，497）处打开宝箱。因此我们可以根据rpgmaker里看到的全地图来手动走完整个迷宫，也可以想办法把地图数据导出来，用程序寻路并且连接服务器发送路线来获得flag。</p>
<p>经过对比发现，地图的层1都是浅色的草地，层2是迷宫墙壁，层3是空的。rpgmakerxp里有选块功能，并且可以复制粘贴。经过对比，选择一个选块，复制粘贴会同时将三个层一起处理。此外，请看下面的对比：<br>选择一个选块，将其三个层均清空，粘贴到winhex里的一个空文件里，可以看到如下十六进制数据：<br><code>0E000000 01000000 01000000 0000 0000 0000</code><br>将该选块层1恢复为浅色草地，再粘贴到winhex里，十六进制数据变为：<br><code>0E000000 01000000 01000000 8001 0000 0000</code><br>将层2恢复为迷宫墙壁，再复制出来，十六进制数据变为：<br><code>0E000000 01000000 01000000 8001 3400 0000</code><br>将层3填充为任意元素，复制出来的十六进制数据为：<br><code>0E000000 01000000 01000000 8001 3400 9F01</code><br>横向选择（0，0）、（1，0），即第一行前两个选块，其十六进制数据为：<br><code>14000000 02000000 01000000 8001 8001 3400 4C00 0000 0000</code><br>纵向选择（0，0）、（0，1），即第一列前两个选快，其十六进制数据为：<br><code>14000000 01000000 02000000 8001 8001 3400 4800 0000 0000</code><br>选择（0，0），（1，0），（0，1），（1，1）四个选块，十六进制数据为：<br><code>20000000 02000000 02000000 8001 8001 8001 8001 3400 4C00 4800 0000 0000 0000 0000 0000</code><br>综合上述数据分析得知，从rpgmakerxp地图编辑器里复制出来的十六进制数据，格式是：</p>
<ul>
<li>4字节总长度T</li>
<li>4字节列数C</li>
<li>4字节行数R</li>
<li>R*C字节层1数据（行优先）</li>
<li>R*C字节层2数据（行优先）</li>
<li>R*C字节层3数据（行优先）</li>
</ul>
<p>如上述最后一组数据，总长度0x20字节，存在0x02行，0x02列；<br>第一行第一列层1数据为0x8001，层2数据为0x3400，层3数据为0x0000<br>第一行第二列层1数据为0x8001，层2数据为0x4c00，层3数据为0x0000<br>第一行第一列层1数据为0x8001，层2数据为0x4800，层3数据为0x0000<br>第一行第一列层1数据为0x8001，层2数据为0x0000，层3数据为0x0000</p>
<p>又根据上面得出的结论，该RPG地图中迷宫墙壁均在层2。再结合上述数据分析，层2不为0x0000的块为迷宫壁，0x0000的块为通道。</p>
<p>因此思路就明确了，rpgmakerxp中ctrl+a全选地图所有块，复制，粘贴到winhex中，保存。再用python写段小程序来解析其中地图数据，即可得到文本化的地图数据，最后使用寻路算法得到迷宫的解，用socket向服务器发送就可以得到flag。</p>
<p>解析地图用的python小脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">with open(&apos;map.bin&apos;, &apos;rb&apos;) as f:</span><br><span class="line">    bMAP = f.read()</span><br><span class="line"></span><br><span class="line">bMAP = bMAP[12:]</span><br><span class="line">bMAP = bMAP[499*499*2:]</span><br><span class="line">c = 0</span><br><span class="line">sMAP = &apos;&apos;</span><br><span class="line"></span><br><span class="line">for i in xrange(499):</span><br><span class="line">    for j in xrange(499):</span><br><span class="line">        if struct.unpack(&quot;H&quot;, bMAP[c:c+2])[0] == 0:</span><br><span class="line">            sMAP += &apos;0&apos;</span><br><span class="line">        else:</span><br><span class="line">            sMAP += &apos;1&apos;</span><br><span class="line">        c +=2</span><br><span class="line">        if j == 498:</span><br><span class="line">            sMAP += &apos;\n&apos;</span><br><span class="line">            </span><br><span class="line">with open(&apos;map.txt&apos;, &apos;w&apos;) as f:</span><br><span class="line">    f.write(sMAP[:-1])</span><br><span class="line"></span><br><span class="line">print &apos;done&apos;</span><br></pre></td></tr></table></figure></p>
<p>迷宫寻路小脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import sys   </span><br><span class="line">sys.setrecursionlimit(1000000)</span><br><span class="line"></span><br><span class="line">with open(&apos;map.txt&apos;, &apos;r&apos;) as f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line">grid = []</span><br><span class="line">for line in lines:</span><br><span class="line">    grid.append(list(line.strip(&apos;\n&apos;)))</span><br><span class="line"></span><br><span class="line">grid[497][497] = &apos;2&apos;</span><br><span class="line">route = &apos;&apos;</span><br><span class="line">def search(x, y):</span><br><span class="line">    global route</span><br><span class="line">    if grid[x][y] == &apos;2&apos;:</span><br><span class="line">        return True</span><br><span class="line">    elif grid[x][y] == &apos;1&apos;:</span><br><span class="line">        return False</span><br><span class="line">    elif grid[x][y] == &apos;3&apos;:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    # mark as visited</span><br><span class="line">    grid[x][y] = &apos;3&apos;</span><br><span class="line">    # explore neighbors clockwise starting by the one on the right</span><br><span class="line"></span><br><span class="line">    #down, s</span><br><span class="line">    if (x &lt; len(grid)-1 and search(x+1, y)):</span><br><span class="line">        route += &apos;s&apos;</span><br><span class="line">        return True</span><br><span class="line">    #left, a</span><br><span class="line">    if (y &gt; 0 and search(x, y-1)):</span><br><span class="line">        route += &apos;a&apos;</span><br><span class="line">        return True</span><br><span class="line">    #up, w</span><br><span class="line">    if (x &gt; 0 and search(x-1, y)):</span><br><span class="line">        route += &apos;w&apos;</span><br><span class="line">        return True</span><br><span class="line">    #right, d</span><br><span class="line">    if (y &lt; len(grid)-1 and search(x, y+1)):</span><br><span class="line">        route += &apos;d&apos;</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">search(1, 1)</span><br><span class="line">print route[::-1]</span><br></pre></td></tr></table></figure></p>
<p>socket发送脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">s = &quot;ddddddddddddssdwdsddssssssssassdddddssdwwdddssdwdwwwddddwwwwwwwwwwdsdsssssssdddssassssssssaawwaaaassaassssddddssssdssaassddsssasssssaawwaaaawwddwwwaasaawwwaasssssddssssssssssdwdwwwwwdssddssassssassdssssssaaassdddssddddssddddssdssaaaaassssssssssssaassaawwwwwwaaassssssaaaaassssawwawaasaassssaaaawwaaaaaaassssdwwdddssssdddssdwdsssdddssddssaasssssdsssddssdddsssdsdddssssssdssdwdwwwdwwawwwwwwdsssdsdddwwdddwwdwwdssdwdwdddwwawwaaaawwddddwwdddssssddssddddddwwaaawwddddwwdsdssssssdwdssssssaaaawwaaassdssddssdwdwddddssssssssssaaaawwdwwawwaaaassawwawaasaassaassaaaawwaaaassssssssddddddwwwaawdddsdsssddssssssddssssssssdwdwdsdsddddwwdddddddddsssdsdwdwwwdwwdssdwdwddwwwwddwwdsdsdwdwdsdsssddddwwwwddwwwwwwddddssdssssdwwdssddssassssssdwdwwwdsdsdssassaassssdwdwddddssssssddddwwwwwaawdddsdsssssddddssddssdwdwwwaawwwaasawwawwddwwwwdssddddddssssdddwwdddssdwwwawaaawwwwaawwddddddwwddwwddwwdsdsssssssaawaasaaassdddddddddddsssdwdssdwdwddddddddwwdsdsdwdwwwdsdsssddddssssaawaasassssdssdwdwwwdddddssssdssdwdwwwwwdssddsssdsssaassssaaassdddssddddddssssddddssssddssdwdwdsdsddssssssssaaassawwaawaasssddssdsssssdsdwdsddssssdwdwdsdsdwdwdwwaaaaawwwwddddddwwddwwwdsdwwdsdsssaassssdwdwddwwdsdwwawawwwwddwwwwdsdsddddwwwwdwwaawwawwwwddddssssdwdwwwdddddwwawwddwwwaawdddsdsssssddssssdwdwdddssdwwwwddddwwwwdwwdssdssssdddwwwwdsdsssdddddssssssassassawwwwwwwaasssaaassddssaaaassssaaaaassssdsssdsssssasssasaawwaaaaassdddssddssssaawwaaaaaaaassssdwdsssddddddwwdsdsssdssaaaawwaaassaawaasssdddddddssssawaasssddssdssaaawwaaaaassdddssssdssssdddddwwwaawwdsdwwdsdsssssssaaassdddddwwdwwawwddddddssdddwwdssdwdwdddwwawaawddddddddwwwwaawwwwddwwwwdssddssdwdsdwdsdwwdsdsdwwdddwwdddssassassassssssdwdwwwddwwdddssssaassdddddddssdwdwdwwawwddwwwwddwdsdwwdsdsssssaassassdddwwdssdssssssssdwdwdddddwwawwddwwdsdsssssdwwwdsdwdsdwwdddssdddddddwwdsssdwwdsssssdssdwwwwwwwwdsdsdddssassssssdwdwwwdsdsssdwdwwwdsdwwwwwdsdsssssssdwdwwwwwwwddwwdddssassssssdwdsdssdwwdsdsddddddddssssdssssaaaaassssssssassdddssssdssssdssssddssssssdwdwwwdsdsssdwdwwdsdwwdsdsddddssssssaawwwaasaaaassaawaasssdddssssddddwwawwwwdssdddssssdssssdddwwdsdsdssassaawaasaaaaaaassddssdwwddddddssdwdwddwwdsdsdwdwdsdsdddddddddssssdwwwwwawaaaawwaaaaaaaaawwddddwwwwdsdsssdwdwwwwwdsdsdssssddssdwwwwddwwdsdwwawwwaawwaaaaawwddddddddddddwwwwdsdsssssaaassdssdwdwdsdsddddddddddssdwdwwwaaaaaaaawwdwwdssddddwwdsdsddssssssddssdwwdwwwwwwddwwdddddddssassssdsssdsssssassdssssssassdddssdddssaaaaaaawaasssssssddddddwwdsdsssddddddwwwdssdsdssssdddssssdwdwwwdddssssssdwwddddwwddwwwwddddssdwdwdsdsssssddddssddssdssassssdssaaasssssssdwdssdddwwawwddddssssssssaaaaaaaawwaawwwwwwwwaawwwwwaasssssaawaasaassssdddwwdssdwwdddssssssaaaassssdssassaassssaaaawwwwaaassdssssddddssssdwdwwwdsdsssddddddssdssaaawaasaawwaaaaaassaawwwaasssssssdsssdwdsdwdsdsdwdsssdssdddssssaassssaassaassaaawwaaassssdssddssaaaaaaaaawwdddwwaaaaassssssaawwaaaaaaaassssssdwdwwwdssdddssssssaassssssdddssssdwwdsdsddssssssssssssdddsssdsddddwwddwwwwdsdssdwdssdwdwdddssassaaaassssaawwaaaaaaaassssdwdwdddssassssdwdwdsdsddddssddddsdwdssssdwdwwwwwwaasaawwwwwwdsdsdwdwwwdwwdsdwdssssssssssassssdwwdssdddddddssssaawwaaaaassssaaawaassssdwdssdwdwdsdsssdwwwdwdsdsssssassdddssssssssssssaassssdwdwdsdsssssaassssdwdwddwwdssssassssddddsdwdssdwdwdsdsssssssaassaaaaaassaaaaaaaawwwwaawwaaassssdssssdssdwwdddssdwdsdwwdddssdwdsdwwwwdsdsssdwdwdsds&quot;</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.connect((&apos;202.120.7.132&apos;, 9999))</span><br><span class="line">for x in s:</span><br><span class="line">    sock.send(x+&apos;\n&apos;)</span><br><span class="line">sock.send(&apos;flag\n&apos;)</span><br><span class="line">print sock.recv(1024)</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure></p>
<p>至此，此题得以解决。但是，该题服务端在比赛结束后已被关闭，且官方也没有放出服务端脚本。因此，我根据程序逻辑写了一个简单的服务端，可以基本实现原服务端的功能，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">__author__ = &apos;Bee&apos;</span><br><span class="line"></span><br><span class="line">from threading import Thread</span><br><span class="line">from socket import *</span><br><span class="line"></span><br><span class="line">LISTEN_ON = &apos;0.0.0.0&apos;</span><br><span class="line">LISTEN_PORT = 8888</span><br><span class="line"></span><br><span class="line">class R_Server(Thread):</span><br><span class="line">    def __init__(self, map, pSocket):</span><br><span class="line">        Thread.__init__(self)</span><br><span class="line">        self.map = map</span><br><span class="line">        self.pSocket = pSocket</span><br><span class="line">        self.x = 1</span><br><span class="line">        self.y = 1</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        try:</span><br><span class="line">            Flag = True</span><br><span class="line">            while Flag:</span><br><span class="line">                key = self.pSocket.recv(4096)</span><br><span class="line">                for i in xrange(0, len(key)):</span><br><span class="line">                    if key[i] == &apos;w&apos; and self.map[self.x - 1][self.y] != &apos;1&apos;:</span><br><span class="line">                        #print &apos;w&apos;</span><br><span class="line">                        self.x -= 1</span><br><span class="line">                    elif key[i] == &apos;a&apos; and self.map[self.x][self.y - 1] != &apos;1&apos;:</span><br><span class="line">                        #print &apos;a&apos;</span><br><span class="line">                        self.y -= 1</span><br><span class="line">                    elif key[i] == &apos;s&apos; and self.map[self.x + 1][self.y] != &apos;1&apos;:</span><br><span class="line">                        #print &apos;s&apos;</span><br><span class="line">                        self.x += 1</span><br><span class="line">                    elif key[i] == &apos;d&apos; and self.map[self.x][self.y + 1] != &apos;1&apos;:</span><br><span class="line">                        #print &apos;d&apos;</span><br><span class="line">                        self.y += 1</span><br><span class="line">                    elif key[i] == &apos;f&apos; and key[i:i+4] == &apos;flag&apos;:</span><br><span class="line">                        if self.x == 497 and self.y == 497:</span><br><span class="line">                            self.pSocket.send(&apos;Flag&#123;This is the Flag.&#125;&apos;)</span><br><span class="line">                            self.pSocket.close()</span><br><span class="line">                            Flag = False</span><br><span class="line">                            print &quot;Flag sent.&quot;</span><br><span class="line">                            break</span><br><span class="line">                        else:</span><br><span class="line">                            self.pSocket.send(&quot;no cheat.&quot;)</span><br><span class="line">                            self.pSocket.close()</span><br><span class="line">                            Flag = False</span><br><span class="line">                            print &quot;Cheating.&quot;</span><br><span class="line">                            break</span><br><span class="line">        except Exception,ex:</span><br><span class="line">            raise</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    MAP = []</span><br><span class="line">    with open(&apos;map.txt&apos;, &apos;r&apos;) as f:</span><br><span class="line">        MAP = f.readlines()</span><br><span class="line"></span><br><span class="line">    servSock = socket(AF_INET,SOCK_STREAM)</span><br><span class="line">    servSock.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)</span><br><span class="line">    servSock.bind((LISTEN_ON, LISTEN_PORT))</span><br><span class="line">    servSock.listen(1000)</span><br><span class="line">    print &quot;Listened on: &#123;&#125;:&#123;&#125;&quot;.format(LISTEN_ON, LISTEN_PORT)</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            sock,addr_info=servSock.accept()</span><br><span class="line">            print &quot;incoming connection from &#123;&#125;.&quot;.format(addr_info)</span><br><span class="line">            R_Server(MAP, sock).start()</span><br><span class="line">        except KeyboardInterrupt, ex:</span><br><span class="line">            break</span><br><span class="line">    servSock.close()</span><br></pre></td></tr></table></figure></p>
<p>相关文件：<br>原题附件 <a href="http://lab.imbeee.com/res/ISG2015-RPG-400-Writeup/RPG.zip" target="_blank" rel="noopener">RPG.zip</a><br>服务端 <a href="http://lab.imbeee.com/res/ISG2015-RPG-400-Writeup/RGP_Server.rar" target="_blank" rel="noopener">RPG_Server.rar</a><br>二进制地图文件以及相关脚本 <a href="http://lab.imbeee.com/res/ISG2015-RPG-400-Writeup/map_scripts.rar" target="_blank" rel="noopener">map_scripts.rar</a></p>
</div><div class="tags"><a href="/tags/Writeup/">Writeup</a></div><div class="post-nav"><a class="pre" href="/2017/12/10/install-pure-system-on-vps-and-encrypt-it/">给vps挂载iso安装系统并加密系统分区</a><a class="next" href="/2016/01/06/reGeorgSocksProxy-with-single-session-mode/">reGeorgSocksProxy修改版-可指定Cookie</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://www.imbeee.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Writeup/" style="font-size: 15px;">Writeup</a> <a href="/tags/Pentest/" style="font-size: 15px;">Pentest</a> <a href="/tags/Tool/" style="font-size: 15px;">Tool</a> <a href="/tags/Homelab/" style="font-size: 15px;">Homelab</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Embedded/" style="font-size: 15px;">Embedded</a> <a href="/tags/ARM/" style="font-size: 15px;">ARM</a> <a href="/tags/LKM/" style="font-size: 15px;">LKM</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://imbeee.github.io/" title="Github Pages备份" target="_blank">Github Pages备份</a><ul></ul><a href="https://ymr.me/" title="野蛮人の洞窟" target="_blank">野蛮人の洞窟</a><ul></ul><a href="http://bksec.net/" title="my5t3ry的blog" target="_blank">my5t3ry的blog</a><ul></ul><a href="https://www.blackh4t.org/" title="DarkRay's BLoG.!" target="_blank">DarkRay's BLoG.!</a><ul></ul><a href="https://www.iswin.org/" title="随风's Blog" target="_blank">随风's Blog</a><ul></ul><a href="http://www.00theway.org/" title="00theway's Blog" target="_blank">00theway's Blog</a><ul></ul><a href="https://threathunter.org/" title="ThreatHunter社区" target="_blank">ThreatHunter社区</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Beeeの零碎事.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>